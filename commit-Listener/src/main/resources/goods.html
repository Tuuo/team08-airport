<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吴修清-商品管理界面</title>
    <link rel="stylesheet" href="/layui/css/layui.css"/>
    <style>
        .layui-form-label {
            white-space: nowrap
        }

        .layui-inline .layui-input-inline button {
            border-radius: 5px;

        }

        .layui-breadcrumb {
            position: relative;
            top: 5px;
            left: 15px;
        }

        .layui-btn {
            width: 80px;
            height: 30px;
            line-height: 30px;
        }

        #addOrUpdateBillDiv .layui-inline {
            margin: 0 auto;
            display: block;
        }

        #addOrUpdateBillDiv .titleContent {
            margin: 10px 0;
        }

        #addOrUpdateBillDiv .layui-input-inline input {
            width: 200px;
        }
    </style>
</head>

<body>
<span class="layui-breadcrumb">
        <a href="http://localhost:8080/wuxiuqing/login.html">首页</a>
        <a href="http://localhost:8080/wuxiuqing/goods.html">超市管理</a>
        <a href="http://localhost:8080/wuxiuqing/type.html">商品类型管理</a>
    </span>

<table id="newsTable" lay-filter="newsTable"></table>


<script src="/layui/layui.js"></script>
<script type="text/html" id="tableBar">
    <form class="layui-form" lay-filter="searchFrom">
        <div class="layui-form-item">
            <div class="layui-inline">

                <label class="layui-form-label">编号</label>
                <div class="layui-input-inline">
                    <input id="gid" type="text" name="id" lay-verify="title" autocomplete="off"
                           placeholder="请输入编号" class="layui-input">
                </div>
                <label class="layui-form-label">商品名称</label>
                <div class="layui-input-inline">
                    <input id="gname" type="text" name="gname" lay-verify="title" autocomplete="off"
                           placeholder="请输入名称" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-inline" style="width: 100px;">

                    <button type="button" class="layui-btn  layui-btn-norma" lay-submit lay-filter="doSearch">搜索
                    </button>
                </div>
            </div>
        </div>
    </form>

    <div id="newsBtns" class="layui-btn-container" lay-filter="newsBtns">
        <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="add">添加</a>
    </div>

</script>
<div id="addOrUpdateBillDiv" style="display: none;margin: 10px">
    <form id="dataFrm" method="post" class="layui-form  layui-form-pane" lay-filter="dataFrm">
        <!-- 隐藏域，保存当前账单的ID -->
        <input type="hidden" name="id">
        <div class="layui-form-item">
            <div class="layui-inline">
                <div class="titleContent">
                    <label class="layui-form-label">商品名称</label>
                    <div class="layui-input-block" style="width: 200px;">
                        <input id="name" type="text" name="gname" lay-verify="title" autocomplete="off"
                               placeholder="请输入名称" class="layui-input">
                    </div>
                </div>
                <div class="titleContent">
                    <label class="layui-form-label">商品类型</label>
                    <div class="layui-input-block">
                        <select id="type" name="type" lay-verify="required" lay-search="">
                            <option value="" selected>请选择</option>
                        </select>
                    </div>
                </div>

                <div class="titleContent">
                    <label class="layui-form-label">商品价格</label>
                    <div class="layui-input-block" style="width: 200px;">
                        <input id="price" type="text" name="price" lay-verify="title" autocomplete="off"
                               placeholder="请输入价格" class="layui-input">
                    </div>
                </div>
                <div class="titleContent">
                    <label class="layui-form-label">原产地</label>
                    <div class="layui-input-block" style="width: 200px;">
                        <input id="origin" type="text" name="origin" lay-verify="title" autocomplete="off"
                               placeholder="请输入原产地" class="layui-input">
                    </div>
                    <br>
                </div>


                    <div class="titleContent">
                        <div class="layui-form-item" style="text-align: center;">
                            <br>
                            <br>
                            <button type="button" class="layui-btn" lay-submit lay-filter="doSubmit">提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </div>

            </div>


    </form>
</div>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="edit" id="e">修改</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" id="r">删除</a>
</script>

<script>
    layui.use(function () {
        let table = layui.table
        let $ = layui.$
        let layer = layui.layer
        var form = layui.form;
        var laydate = layui.laydate;
        // 自定义格式



        $.get("/wuxiuqing/type", (result) => {
            var html = "";
            for (let i = 0; i < result.length; i++) {
                html += "<option value='" + result[i].tid + "'>" + result[i].tname + "</option>";
            }
            $("[name='type']").append(html);
            form.render("select");
        }, "json");


// 搜索功能
        form.on("submit(doSearch)", (data) => {

            // 判断是否有搜索条件，如果没有，则将查询参数设置为空对象
            console.log(data)
            console.log(data.field)
            tableInfo.reload({
                where: data.field,
                page: {
                    curr: 1
                }
            }, "data");

            // 禁止页面刷新
            return false;
        });


        //渲染表格组件
        var tableInfo = table.render({
            elem: "#newsTable",
            toolbar: "#tableBar",
            url: "/wuxiuqing/pageall",
            cols: [[
                {checkbox: true, fixed: "left", width: 50},
                {field: "id", title: "编号",width: 120},
                {field: "tname", title: "类型", width: 300},
                {field: "gname", title: "商品名称",width: 300},
                {field: "price", title: "商品价格", width: 200},
                {field: "origin", title: "商品产地",width: 300},
                {title: "操作", templet: "#barDemo"}

            ]],
            dataType: "json",
            id: 'test',
            page: true, // 是否显示分页
            limits: [5, 10, 15],
            limit: 5 // 每页默认显示的数量


        });

        //搜索功能

        table.on("toolbar(newsTable)", (obj) => {
            switch (obj.event) {
                case 'add':
                    openAddWindow();
                    break;

            }
        });
        //监听表格操作
        table.on("tool(newsTable)",(obj)=>{
            switch (obj.event){
                case 'edit':
                    openUpdateWindow(obj.data);
                    break;
                case 'del':
                    deleteById(obj.data);
                    break;
            }
        });

        var url;
        var mainIndex;

        /**
         * 打开添加窗口
         */
        function openAddWindow() {
            mainIndex = layer.open({
                type: 1,
                title: "添加商品信息",
                area: ['30%', '50%'],
                content: $("#addOrUpdateBillDiv"),
                success: function () {
                    //清空表单数据
                    $("#dataFrm")[0].reset();
                    //url变量
                    url = "/wuxiuqing/save";
                }
            });
        };



        /**
         * 打开编辑窗口
         */
        function openUpdateWindow(data) {
            mainIndex = layer.open({
                type: 1,
                title: "修改商品信息",
                area: ['30%', '50%'],
                content: $("#addOrUpdateBillDiv"),
                success: function () {
                    //让表单数据回显
                    form.val("dataFrm",data);
                    url = "/wuxiuqing/update";
                }
            });
        };
        //按钮
        form.on("submit(doSubmit)", (data) => {
            var formData = data.field;
            console.log(data)
            console.log(formData)


            $.post(url, formData, (result) => {
                console.log(result.success)
                console.log(result.message)
                if (result.success) {
                    layer.alert(result.message, {icon: 1})
                    //关闭窗口
                    layer.close(mainIndex);
                    //刷新数据表格
                    tableInfo.reload();

                } else {
                    layer.alert(result.message, {icon: 2})
                }
            }, "json");
            return false;
        });
        /**
         * 删除信息
         */
        function deleteById(data){
            //提示用户确认是否删除
            layer.confirm("确定要删除["+data.gname+"]的信息吗？",{icon:3,title:"提示"},(index)=>{
                $.post("/wuxiuqing/deleteById",{"id":data.id},(result)=>{
                    if (result.success) {
                        layer.alert(result.message, {icon: 1})
                        //刷新数据表格
                        tableInfo.reload();
                    } else {
                        layer.alert(result.message, {icon: 2})
                    }
                },"json")
                layer.close(index)
            });
        }

    });


</script>
</body>

</html>